## Apache Kafka 정리 



#### 1. 주키퍼 
> 카프카 클러스트를 운용하기 위해서 반드시 필요한 애플리케이션<br>
>

#### 2. 브로커
> 브로커는 데이터를 분산 저장하여 장애가 발생하더라도 안전하게 사용할 수 있도록 도와주는 애플리케이션다.<br>
> 상용환경에서는 하나의 클러스터를 운용할때 3개이상의 브로크를 사용하는것이 일반적이다.

#### 2-1. 브로커의 역할
> config/server.properties의 log.dir 옵션에 정의한 디렉토리에 데이터를 저장한다.<br> 
> 토픽이름과 파티션 번호의 조합으로 하위 디렉토리를 생성하여 데이터를 저장한다.

해당 하위 디렉토링 안에있는파일중에서 
 - log에는 메세지와 메타데이터를 저장한다. 
 - index는 메시지의 오프셋을 인덱싱한 정보를 담은 파일이다.
 - timeindex 파일에는 메세지에 포함된 timestamp값을 기준으로 인덱싱한 정보가 담겨있다.

---

### 컨트롤러
> 클러스터의 다수 브로커중 한 대가 컨트롤러의 역할을 하며, 컨트롤러는 다른 브로커들의 상태를 체크하며, 다른 브로커가
> 클러스터에서 빠지는 경우 해당 브로커에 존재하는 리더 파티션을 재분배한다.
> 
> 컨트롤러 역할을 하는 브로커에 장애가 생기면 다른 브로커가 컨트롤러 역할을한다.

---

#### 데이터 삭제
> 컨슈머가 데이터를 가져가더라도 토픽의 데이터는 삭제되지 않는다. <br>
> 데이터 삭제는 파일 단위로 이루어지는데 이 단위를 로그 세그먼트라고 부른다.


#### 그룹 코디네이터
> 컨슈머 그룹의 상태를 체크하고 파티션을 컨슈머와 매칭되도록 분배하는 역할을한다.<br>

---

#### 로그와 세그먼트

- log.segment.bytes - 바이트 단위의 최대 세그먼트 크기 지정, default 1GB
- log.roll.ms(hours) - 세그먼트가 신규 생성된 이후 다음 파일로 넘어가는 시간 주기, default 7일

가장 마지막 세그먼트 파일을 `액티브 세그먼트`라고 부른다. 엑티브 세그먼트는 브로커의 삭제 대상에서 포함되지 않는다.
엑티브 세그먼트가 아닌 세그먼트는 위의 retention 옵션에 따라 삭제 대상으로 지정된다.