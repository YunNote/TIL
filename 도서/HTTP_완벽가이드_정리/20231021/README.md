# 클라이언트 식별과 쿠키

> 해당 내용에서는 서버가 통신하는 대상을 식별하는데 사용하는 기술에 대해 본다.

---

## 개별 접촉

HTTP는 익명으로 사용하며 상태가 없고, 요청과 응답으로 통신하는 프로토콜이다. 따라서 요청을 처리하고나서 응답을 
클라이언트로 전송하게 된다. 

서버는 요청을 보낸 사용자에 대해서 식별하기 위해 약간의정보를 이용할 수 있다.

1. 개별인사 : 사용자에게 특화된 메시지나 페이지 내용을 만든다.
2. 사용자 맞춤 추천 : 사용자가 좋아할만한 내용에 대한 컨텐츠를 추천한다. 특정 이벤트에 대한 컨텐츠를 제시할수도 있다.
3. 저장된 사용자 정보 : 복잡한 주소라던지, 특정한 정보들을 매번 기입하는것은 사용자들이 싫어한다. 따라서 사용자가 편하게 사용 할 수 있게끔 저장된 사용자 정보를 사용한다.

4. 세션 추적 : HTTP트랜잭션은 상태가 없다. 많은 웹사이트에서는 사용자가 사이트와 상호작용할 수 있도록 사용자의 상태를 남긴다. 이러한 상태를 유지하기 위해서는 사용자에게서 오는 HTTP트랜잭션에 대해서 식별할 방법이 필요하다.

---


## HTTP 헤더 

사용자에 대한 정보를 전달하는 HTTP헤더는 대략적으로 다음과 같다

`From` - 요청 타입이며 사용자의 이메일 주소를 의미한다.<br>
> From 의 경우 사용자의 이메일을 각각 다르게 가지고있는것이 이상적이지만, 악의적으로 이메일을 모아서 스팸을 발송하는 문제가있어
> 헤더를 보내는 브라우저는 많지 않다. 다만 크롤링봇이나 데이터를 수집하는 봇들은 본의아니게 문제를 발생시킬 수 있어 웹사이트에게 From 헤더를 통해 연락가능한 이메일을 제공한다.

<br>

`User-Agent` - 요청 타입이며 사용자의 브라우저 정보를 담고 있다. <br>
> 사용자가 사용하고있는 브라우저의 이름과 버전 정보, 어떤 경우에는 운영체제에 대한 정보까지 서버에게 알려준다.

<br>

`Referer` - 요청 타입이며, 사용자가 현재 링크를 타고온 근원 페이지를 의미한다 <br>
> 사용자가 현재 페이지로 유입하게 한 웹페이지의 URL을 가리킨다. 해당 헤더만으로 사용자를 식별할 수는 없지만
> 사용자가 이전에 어떠한 페이지를 방문하였는지 알려준다.

`Authorization` - 요청 타입이며 사용자의 이름과 비밀번호를 의미 <br>
`Client-ip` - 확장(요청) 타입이며, 클라이언트의 IP주소 <br>
`X-Forwarded-For` - 확장(요청) 타입이며, 클라이언트의 IP주소 <br>
`Cookie` - 확장(요청) 타입이며, 서버가 생성한 ID정보  <br>

---

## 클라이언트 IP 주소 

초기 웹에서는 식별에 클라이언트 IP주소를 사용하고자 하였다. 해당 방식은 사용자의 확실한 IP주소를 가지고 있고, 좀처럼 혹은 아예 변경되지 않기 때문에
요청마다 클라이언트의 IP를 알 수 있따면 문제 없이 동작한다.
(IP는 서버에서 TCP케넥션의 Ip주소를 알아낼 수 있다.)

다만 해당 방식은 다음과 같은 약점을 가지고 있다.

- 클라이언트 IP주소는 사용자가 아닌 해당 컴퓨터를 가리키기 때문에 여러 사용자가 해당 컴퓨터를 공용으로 사용하게 된다면 특정 사용자를 식별할 수 없다.
- 인터넷 서비스 제공자는 사용자가 로그인하면 동적IP를 할당한다 따라서 매번 다른 주소를 받기 때문에 사용자라를 IP주소로 식별할 수 없다.
- 보안을 강화하고 부족한 주소를 관리하기위해 NAT 방화벽을 통해 인터넷을 사용한다. 해당 NAT방식은 실제 IP주소를 방화벽 뒤로 숨기고 실제 IP주소를 내부에서 사용하는 하나의 방화벽 IP주소로 변환하기 때문에 식별하기 힘들다.
- 보통 HTTP 프록시와 게이트웨이는 원 서버에 새로운 TCP연결을 한다. 따라서 웹서버에서는 실제 클라이언트의 IP가 아닌 프록시 또는 게이트웨이의 IP주소를 바라본다. 일부 프록시는 IP주소를 보존하기위해 확장 헤더를 추가하여 해당 문제를해결하려고 하였다. 다만 모든 프록시가 지원하지는 않는다.

---

## 사용자 로그인 
 
위에나온 클라이언트 IP보다 사용자의 접속 정보로 명시적으로 식별요청을 할 수도 있다.

HTTP에서는 로그인이 더 쉽도록 Authorization헤더를 사용하여 해당 사용자의 정보를 전달하는 자체적인 체계를 가지고 있다.

한번 로그인하게되면 그다음 요청에 대해서 로그인 정보를 함께 보내기 때문에 서버에서는 사용자를 항상 확읺가능하며, 사이트에 접근하기전
로그인이 되어있지 않다면 로그인 페이지로 이동하라고 응답 코드를 내릴 수 있다.

---

## 뚱뚱한 URL

어떤 웹사이트들은 URL의 경로의 처음 또는 끝에 사용자의 상태정보를 포함도록 하였고 이를 뚱뚱한 URL 이라고 한다.
거의 모든 URL에 해당 상타에 대한 문자열을 담도 다녔다. 하지만 해당 기술에는 여러 문제가 있다.

1.못생긴 URL
> URL이 너무 복자뱋져 사용자들에게 혼란을 줄 수 있다.

2. 공유하지 못하는 URL
> URl에 사용자에 대한 상태정보가 포함되다 보니 해당 URL을 다른사람이 알게된다면 본의아니게 개인 정보를 공유하게 된다.

3. 서버 부하 증가
> 서버는 뚱뚱한 URL에 해당하는 HTML페이지를 다시 그려야 한다. 

4. 이탈 
> URL을 의도지 않게 사용하여 URL 세션에서 이탈 하기 쉽다. 

5. 세션 간 지속성으 ㅣ부재
> 사용자가 URL을 북마킹 하지 않는 이상 로그아웃을 하면 모든 정보를 잃는다.

---

## 쿠키 