# 캐시

---

캐시는 자주 쓰이는 문서의 사본을 자동으로 보관하는 HTTP 장치이다.

웹 요청이 도착했을때 캐시에 해당 사본이 존재한다면 해당 사본을 제공하고 없다면 원 서버로 요청한다.

 - 캐시는 불필요한 데이터 전송을 줄여서 네트워크 요금으로 인한 비용을 줄여준다.
 - 캐시는 네트워크의 병목ㅇ르 줄인다. 대역폭을 늘리지 않고도 페이지를 빠르게 불러올 수 있다.
 - 캐시는 원 서버에 대한 요청을 줄여준다. 서버는 부하를 줄일 수 있으며 빠르게 응답 할 ㅅ ㅜ있다.
 - 페이지를 먼곳에서 불러올수록 시간이 오래걸리는데, 캐시는 거리로 인한 지연을 줄여준다.

---

## 🧐 불필요한 데이터 전송

여러 클라이언트가 원 서버에 접근할때 서버는 같은 문서에 대해서 클라이언트들에게 각각 한번 씩 전송하게 된다.

같은 내용의 문서들을 계속해서 반복적으로 전송하게 된다면 값비싼 네트워크 대역폭을 잡아먹고, 전송을 느리게 만들어
웹 서버에 부하를 준다. 

캐시를 이용하면 첫번째 응답은 캐시에 보관된다. 캐시된 사본이 그다음 요청들에 대해서 사본을 응답으로 사용하게 된다.

이는 원 서버가 중복해서 트래픽을 주고받는 낭비가 줄어들게 된다.

---

## 🧐 대역폭 병목

캐시는 네트워크 병목을 줄여준다. 클라이언트들이 서버에 접근할 때의 속도는
그 경로에 있는 가장 느린 네트워크의 속도와 같다. 만약 클라이언트가 빠른 LAN에 있는 캐시로부터
사본을 가져온다면 캐싱은 성능을 대폭 개선할 수 있다.

---

## 🧐 갑작스러운 요청 쇄도(Flash Crowds)

캐싱은 갑작스런 요청 쇄도에 대처하기 위해서도 중요하다.

갑작스런 이슈로 인해 많은 클라이언트로부터 요청이 쇄도한다면 초래된 불필요한 트래픽 급증으로 인해
네트워크와 웹서버의 심각한 장애를 발생히킨다.

---

## 🧐 거리로 인한 지연

대역폭이 문제가 되지 않더라도, 거리에 따른 문제가 발생할 수 있다.

모든 네트워크라우터는 제각각 인터넷 트래픽을 지연시킨다. 그리고 클라리언트와 서버 사이에
라우터가 많지 않더라도 유의미한 지연을 유발한다.

해결하기 위해서는 근처에 캐시를 설치해서 문서가 전송되는 거리를 줄일 수 있다.

---

## 🧐 적중과 부적중

캐시는 유용하다. 그러나 캐시가 모든 문서의 사본을 저장하지는 않는다.

캐시에 요청이 도착했을때 만약 대응하는 사본이 잇다면 그를 이용해 요청을 처리할 수 있다.
이것을 캐시가 적중했다고 한다.  

만약 대응하는 사본이 없는 경우 그냥 원서버로 전달이되어 요청을 처리한다 이것을 캐시 부적중(cache miss)이라고 한다.

---

## 🧐 재검사

원 서버 컨텐츠는 변경될 수 있기 때문에 캐시는 반드시 갖고있는 사본이 최신인지 서버를 통해 점검해야 한다.
이러한 방법을 `HTTP 재검사`라고 부른다 

캐시는 스스로 원한다면 언제든지 사본을 재검사할 수 있다. 그러나 캐시가 문서를 수백만개씩 
가지고있는 경우가 흔한데 비해 네트워크 대역폭은 부족하다, 따라서 캐시는 클라이언트가 사본을 요청하면
해당 사본이 검사를 할 필요가 있을 정도로 충분히 오래된 경우에만 재검사를 한다.

캐시는 캐시된 사본의 재검사가 필요할 때 원 서버에 작은 재검사 요청을 보내고 콘텐츠가 변경되지 않았다면 
`304 Not Modified`응답을 보낸다. 

사본이 여전히 유효함을 알게된 캐시는 사본이 신선하다고 표시한 뒤 클라이언트에 제공한다 이를 `재검사 적중` or `느린 적중`
이라고 부른다.

재검사 적중은 순수 캐시보다는 느리고, 캐시 부적중보다는 빠르다.

HTTP는 캐시된 객체를 재확인하기 위한 도구로 다음과 같은 헤더를 제공한다.

#### `If-Modified-Since`헤더
서버에게 보내는 GET요청에 해당 헤더를 추가하면 캐시된 시간 이후에 변경된 경우에만 사본을 보내달라는 의미가 된다.

If-Modified-Since 를 사용하였을때 발생할 수 있는 세가지 상황

1. 재검사 적중
> 만약 서버 객체가 변경되지 않았다면, 서버는 클라이언트에게 `304 Not Modified`응답을 보낸다.

2. 재검사 부적중
> 만약 서버 객체가 캐시된 사본과 다르다면, 서버는 콘텐츠 전체와 함께 평범한 `200 OK`응답을 클라이언트에게 보낸다.

3. 객체 삭제
> 만약 서버 객체가 삭제되었다면, 서버는 `404 NotFound` 응답을 반환하며 캐시는 사본을 삭제한다.


---

### 적중률 